<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety & Alignment Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Segoe UI', 'Segoe UI Web (West European)', 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        /* Demand-Ability Bar Chart */
        .demand-bars {
            display: flex;
            gap: 2px;
            height: 40px;
            align-items: flex-end;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            flex: 1;
        }
        
        .demand-bar {
            width: 4px;
            height: 40px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            border-radius: 0;
            will-change: transform;
        }
        
        .bar-red { background-color: #ef4444; }
        .bar-orange { background-color: #eab308; }
        .bar-green { background-color: #84cc16; }
        .bar-gray { background-color: #e5e7eb; }

        /* Status Dot Colors */
        .status-dot-red { background-color: #ef4444; box-shadow: 0 0 0 2px #7f1d1d; }
        .status-dot-orange { background-color: #eab308; box-shadow: 0 0 0 2px #854d0e; }
        .status-dot-green { background-color: #84cc16; box-shadow: 0 0 0 2px #365314; }

        /* Tooltip Logic */
        .has-tooltip:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
        .tooltip-content {
            visibility: hidden;
            opacity: 0;
            transform: translateY(4px);
            transition: all 0.2s;
        }

    </style>
</head>
<body>

    <!-- Main Header -->
    <header class="bg-[#0A142D] rounded-none p-6 mb-8 shadow-xl max-w-[1400px] mx-auto">
        <h1 class="text-2xl font-bold mb-4 text-white">Agent Safety & Alignment</h1>
        <div class="flex flex-wrap gap-6 text-sm font-semibold">
            <div class="flex items-center">
                <span class="w-2.5 h-2.5 rounded-full bg-red-500 mr-2"></span>
                <span class="text-white">ACTIVE THREATS: 3</span>
            </div>
            <div class="flex items-center">
                <span class="w-2.5 h-2.5 rounded-full bg-yellow-500 mr-2"></span>
                <span class="text-white">HIGH LOAD: 4</span>
            </div>
            <div class="flex items-center">
                <span class="w-2.5 h-2.5 rounded-full bg-cyan-500 mr-2"></span>
                <span class="text-white">PII ALERTS: 4</span>
            </div>
        </div>
    </header>

    <!-- Dashboard Grid -->
    <main class="max-w-[1400px] mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="card-grid">
            <!-- Cards will be injected here by JS -->
        </div>
    </main>

    <script>
        // Data Structure
        const cards = [
            {
                id: "AG-01",
                name: "FinTech-Advisor-1-01",
                model: "GPT-4o",
                status: "red",
                privacy: { status: "PII ALERT / SSN", type: "warning" },
                demand: { val: 96, color: "red" },
                malice: "4.9",
                maliceColor: "red",
                toxicity: "3.8",
                grounding: "1.2", 
                context: "93k",
                step: "11/20"
            },
            {
                id: "AG-02",
                name: "Support-Agent-2-02",
                model: "Claude-3.5-Sonnet",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 70, color: "green" },
                malice: "1.4",
                maliceColor: "dark",
                toxicity: "1.4",
                grounding: "4.8", 
                context: "104k",
                step: "15/20"
            },
            {
                id: "AG-03",
                name: "Code-Gen-3-03",
                model: "Mistral-Large",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 65, color: "green" },
                malice: "1.4",
                maliceColor: "dark",
                toxicity: "1.3",
                grounding: "4.5",
                context: "75k",
                step: "17/20"
            },
            {
                id: "AG-04",
                name: "HR-Helper-4-04",
                model: "Llama-3-70B",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 60, color: "green" },
                malice: "1.6",
                maliceColor: "dark",
                toxicity: "0.8",
                grounding: "4.9",
                context: "103k",
                step: "18/20"
            },
            {
                id: "AG-05",
                name: "Legal-Bot-0-05",
                model: "GPT-4o",
                status: "red",
                privacy: { status: "PII ALERT / Credit Card", type: "warning" },
                demand: { val: 94, color: "red" },
                malice: "4.7",
                maliceColor: "red",
                toxicity: "4.1",
                grounding: "2.1",
                context: "53k",
                step: "12/20"
            },
            {
                id: "AG-06",
                name: "FinTech-Advisor-1-06",
                model: "Claude-3.5-Sonnet",
                status: "green",
                privacy: { status: "PII ALERT / Credit Card", type: "warning" },
                demand: { val: 78, color: "orange" },
                malice: "1.7",
                maliceColor: "dark",
                toxicity: "1.8",
                grounding: "3.5",
                context: "41k",
                step: "6/20"
            },
            {
                id: "AG-07",
                name: "Support-Agent-2-07",
                model: "Mistral-Large",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 46, color: "green" },
                malice: "1.3",
                maliceColor: "dark",
                toxicity: "0.9",
                grounding: "4.7",
                context: "58k",
                step: "12/20"
            },
            {
                id: "AG-08",
                name: "Code-Gen-3-08",
                model: "Llama-3-70B",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 34, color: "green" },
                malice: "0.6",
                maliceColor: "dark",
                toxicity: "0.9",
                grounding: "5.0",
                context: "39k",
                step: "3/20"
            },
            {
                id: "AG-09",
                name: "HR-Helper-4-09",
                model: "GPT-4o",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 33, color: "green" },
                malice: "1.9",
                maliceColor: "dark",
                toxicity: "1.1",
                grounding: "4.6",
                context: "35k",
                step: "10/20"
            },
            {
                id: "AG-10",
                name: "Legal-Bot-0-10",
                model: "Claude-3.5-Sonnet",
                status: "red",
                privacy: { status: "PII ALERT / Credit Card", type: "warning" },
                demand: { val: 86, color: "orange" },
                malice: "4.6",
                maliceColor: "red",
                toxicity: "4.0",
                grounding: "2.8",
                context: "31k",
                step: "12/20"
            },
            {
                id: "AG-11",
                name: "FinTech-Advisor-1-11",
                model: "Mistral-Large",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 89, color: "orange" },
                malice: "0.7",
                maliceColor: "dark",
                toxicity: "1.6",
                grounding: "3.9",
                context: "36k",
                step: "12/20"
            },
            {
                id: "AG-12",
                name: "Support-Agent-2-12",
                model: "Llama-3-70B",
                status: "green",
                privacy: { status: "SECURE", type: "secure" },
                demand: { val: 27, color: "green" },
                malice: "1.3",
                maliceColor: "dark",
                toxicity: "0.9",
                grounding: "4.4",
                context: "8k",
                step: "11/20"
            }
        ];

        const grid = document.getElementById('card-grid');

        // Get the most recent day's demand status for an agent
        function getMostRecentDayStatus(agentId) {
            const pattern = agentPatterns[agentId];
            if (pattern) {
                return pattern[29]; // Last day (index 29)
            }
            return 'green'; // Default
        }

        // Generate 30 vertical bars representing 30 days of historical demand data
        function generateDemandBars(currentDemandVal, agentId) {
            let bars = '';
            
            // Get pattern for this agent, or use default varied pattern
            const pattern = agentPatterns[agentId];
            
            if (pattern) {
                // Use predefined pattern
                for (let i = 0; i < 30; i++) {
                    const barClass = pattern[i] === 'red' ? 'bar-red' : 
                                   pattern[i] === 'orange' ? 'bar-orange' : 'bar-green';
                    bars += `<div class="demand-bar ${barClass}"></div>`;
                }
            } else {
                // Fallback to varied pattern for undefined agents
                const seed = parseInt(agentId.split('-')[1]);
                for (let i = 0; i < 30; i++) {
                    let dailyDemand;
                    if (currentDemandVal >= 85) {
                        dailyDemand = 70 + Math.floor((Math.sin(seed * i * 0.3) * 15 + 15));
                    } else if (currentDemandVal >= 60) {
                        dailyDemand = 40 + Math.floor((Math.sin(seed * i * 0.4) * 25 + 20));
                    } else {
                        dailyDemand = 20 + Math.floor((Math.sin(seed * i * 0.5) * 20 + 15));
                    }
                    dailyDemand = Math.max(10, Math.min(98, dailyDemand));
                    
                    let barClass;
                    if (dailyDemand > 75) {
                        barClass = 'bar-red';
                    } else if (dailyDemand >= 50) {
                        barClass = 'bar-orange';
                    } else {
                        barClass = 'bar-green';
                    }
                    bars += `<div class="demand-bar ${barClass}"></div>`;
                }
            }
            
            return bars;
        }

        // Define agentPatterns globally so it can be accessed by both functions
        const agentPatterns = {
            'AG-01': Array(30).fill('green'),
            'AG-02': Array(30).fill('green').map((val, idx) => {
                if (idx === 22) return 'red';
                if (idx === 23) return 'orange';
                return val;
            }),
            'AG-03': Array(30).fill('green'),
            'AG-04': Array(30).fill('green'),
            'AG-05': Array(30).fill('green').map((val, idx) => {
                return idx < 12 ? 'red' : 'green';
            }),
            'AG-06': Array(30).fill('green'),
            'AG-07': Array(30).fill('green').map((val, idx) => {
                return idx === 29 ? 'orange' : val;
            }),
            'AG-08': Array(30).fill('green'),
            'AG-09': Array(30).fill('green'),
            'AG-10': Array(30).fill('green').map((val, idx) => {
                return idx >= 27 ? 'red' : val;
            }),
            'AG-11': Array(30).fill('green').map((val, idx) => {
                return (idx === 4 || idx === 5) ? 'orange' : val;
            }),
            'AG-12': Array(30).fill('green')
        };

        cards.forEach(card => {
            // Determine status dot color based on most recent demand day
            const recentDayStatus = getMostRecentDayStatus(card.id);
            let statusDotClass;
            if (recentDayStatus === 'red') {
                statusDotClass = 'status-dot-red';
            } else if (recentDayStatus === 'orange') {
                statusDotClass = 'status-dot-orange';
            } else {
                statusDotClass = 'status-dot-green';
            }

            // Icon Logic
            const fingerprintPath = "M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.2-2.848.578-4.13m4.896-.757C8.636 6.046 7.842 6 7 6a6 6 0 00-6 6";
            
            const privacyIcon = card.privacy.type === 'warning' 
                ? `<svg class="w-4 h-4 mr-1.5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${fingerprintPath}"></path></svg>`
                : `<svg class="w-4 h-4 mr-1.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${fingerprintPath}"></path></svg>`;

            const privacyClass = card.privacy.type === 'warning' ? 'text-orange-500 font-bold' : 'text-[#66cc00] font-bold';
            
            const chartTextClass = card.demand.color === 'red' ? 'text-red-500' : 
                                   card.demand.color === 'orange' ? 'text-orange-400' : 'text-[#84cc16]';

            const maliceClass = card.maliceColor === 'red' ? 'text-red-500' : 'text-gray-900';
            const toxicityClass = card.maliceColor === 'red' ? 'text-red-500' : 'text-gray-900';
            
            // Grounding color logic
            let groundingClass = 'text-gray-800';
            const gVal = parseFloat(card.grounding);
            if (gVal >= 4.0) groundingClass = 'text-[#84cc16]'; 
            else if (gVal <= 2.5) groundingClass = 'text-red-500';
            else groundingClass = 'text-gray-800';

            const html = `
                <div class="bg-white shadow-md border-2 border-gray-200 overflow-hidden flex flex-col transition-all duration-200 hover:shadow-xl hover:-translate-y-0.5 cursor-pointer">
                    <!-- Card Header -->
                    <div class="bg-[#0a1930] p-3 flex justify-between items-start">
                        <div class="flex flex-col items-start gap-0.5">
                            <div class="flex items-start gap-2.5">
                                <div class="w-5 h-5 rounded-full ${statusDotClass} mt-0.5"></div>
                                <div class="text-white text-base font-bold">${card.id.replace('AG-', 'AG-0')}</div>
                            </div>
                            <div class="text-gray-400 text-[10px] font-medium" style="margin-left: 30px;">Platform: Databricks</div>
                        </div>
                        <div class="text-right">
                            <div class="text-white font-bold text-base tracking-tight">${card.name}</div>
                            <div class="text-gray-400 text-[10px] font-medium mt-0.5">Model: Claude Sonnet 4.1</div>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="p-4 flex-grow">
                        <!-- Privacy Row -->
                        <div class="flex items-center text-[10px] uppercase font-bold tracking-wider text-gray-500 mb-4">
                            <span class="mr-2">Data Privacy:</span>
                            <div class="flex items-center ${privacyClass}">
                                ${privacyIcon}
                                ${card.privacy.status}
                            </div>
                        </div>

                        <!-- Demand-Ability Bars (Full Width) -->
                        <div class="flex flex-col mb-4">
                            <div class="text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2">Demand-Ability</div>
                            <div class="flex items-center justify-between">
                                <div class="demand-bars">
                                    ${generateDemandBars(card.demand.val, card.id)}
                                </div>
                                <div class="text-sm font-bold ${chartTextClass} ml-3">${card.demand.val}%</div>
                            </div>
                        </div>

                        <!-- Malice/Toxicity/Grounding Stats Row -->
                        <div class="flex justify-between items-center gap-4">
                            <div class="flex flex-col items-center flex-1">
                                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Malice</div>
                                <div class="text-xl font-bold ${maliceClass} leading-none mt-1">${card.malice}</div>
                            </div>
                            
                            <div class="flex flex-col items-center flex-1">
                                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Toxicity</div>
                                <div class="text-xl font-bold ${toxicityClass} leading-none mt-1">${card.toxicity}</div>
                            </div>

                            <div class="flex flex-col items-center flex-1">
                                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Grounding</div>
                                <div class="text-xl font-bold ${groundingClass} leading-none mt-1">${card.grounding}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Info (Agentic Health) -->
                    <div class="bg-gray-50/50 px-4 py-3 border-t border-gray-100 flex justify-between items-center text-xs font-semibold text-gray-500 relative">
                        
                        <!-- Context Usage Tooltip -->
                        <div class="flex items-center cursor-help has-tooltip group relative">
                            <div class="tooltip-content absolute bottom-full left-0 mb-2 px-2 py-1 bg-gray-800 text-white text-[10px] rounded shadow-lg whitespace-nowrap z-20">
                                Risk: "Lost in the Middle" Syndrome<br>Buffer Usage / Max
                            </div>
                            <!-- Chip Icon -->
                            <svg class="w-4 h-4 mr-1.5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>
                            ${card.context} Context
                        </div>

                        <!-- Step/Time Horizon Tooltip -->
                        <div class="flex items-center cursor-help has-tooltip group relative">
                            <div class="tooltip-content absolute bottom-full right-0 mb-2 px-2 py-1 bg-gray-800 text-white text-[10px] rounded shadow-lg whitespace-nowrap z-20 text-right">
                                Agentic Time Horizon<br>Monitor for Loop Failures
                            </div>
                            <!-- Pulse Icon -->
                            <svg class="w-4 h-4 mr-1.5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            Step ${card.step}
                        </div>
                    </div>
                </div>
            `;
            
            grid.innerHTML += html;
        });
    </script>
</body>
</html>